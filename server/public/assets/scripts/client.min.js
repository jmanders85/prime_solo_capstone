var app=angular.module("sheepsheadApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).when("/leagues",{templateUrl:"views/leagues.html",controller:"LeaguesController"}).when("/createLeague",{templateUrl:"views/createLeague.html",controller:"CreateLeagueController"}).when("/events",{templateUrl:"views/events.html",controller:"EventsController"}).when("/hands",{templateUrl:"views/hands.html",controller:"HandsController"}).when("/createEvent",{templateUrl:"views/createEvent.html",controller:"CreateEventController"}).when("/addHands",{templateUrl:"views/addHands.html",controller:"AddHandsController"}).when("/users",{templateUrl:"views/users.html",controller:"UsersController"}).when("/createUser",{templateUrl:"views/createUser.html",controller:"CreateUserController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}),b.html5Mode(!0)}]),app.controller("HeaderController",["$scope",function(a){a.trump=0,a.clubsSpadesClick=function(){0===a.trump||1==a.trump||2==a.trump?(a.trump++,console.log(a.trump)):a.trump=0},a.diamondsHeartsClick=function(){3==a.trump||4==a.trump?a.trump++:a.trump=0}}]),app.controller("HomeController",["$scope","$http","SheepsheadService",function(a,b,c){c.getLeagues(),c.getEvents(),c.getUsers(),a.topScores=[],a.leasters=[],a.mosters=[],a.picksAndWins=[],a.blitzers=[],a.handsPlayed=[],a.positionData=[],a.positionStats=[],a.data=c.data,a.leagueFilter="",a.reloadScores=function(){a.positionStats=[{position:"First",handsWon:0,handsPicked:0},{position:"Middle",handsWon:0,handsPicked:0},{position:"Dealer",handsWon:0,handsPicked:0}];var c="/"+a.leagueFilter;b.get("/api/events_users/topScores"+c).then(function(b){a.topScores=b.data}),b.get("/api/hands/leasters"+c).then(function(b){a.leasters=b.data}),b.get("/api/hands/mosters"+c).then(function(b){a.mosters=b.data}),b.get("/api/hands/winLoss"+c).then(function(b){a.picksAndWins=b.data;for(var c=0;c<a.picksAndWins.length;c++)a.picksAndWins[c].winRatio=Math.round(a.picksAndWins[c].hands_won/a.picksAndWins[c].hands_picked*1e3)/1e3,a.picksAndWins[c].record=""+a.picksAndWins[c].hands_won+" - "+(a.picksAndWins[c].hands_picked-a.picksAndWins[c].hands_won);a.picksAndWins.sort(function(a,b){return b.winRatio-a.winRatio})}),b.get("/api/hands/blitzers"+c).then(function(b){a.blitzers=b.data}),b.get("/api/hands/handsPlayed"+c).then(function(b){a.handsPlayed=b.data}),b.get("/api/hands/positionStats"+c).then(function(b){a.positionData=b.data;for(var c=0;c<a.positionData.length;c++){var d=parseInt(a.positionData[c].dealer_position)+1;d>a.positionData[c].player_count&&(d=1),"0"==a.positionData[c].dealer_position&&(a.positionData[c].dealer_position=a.positionData[c].player_count),(3==a.positionData[c].player_count||5==a.positionData[c].player_count)&&a.positionData[c].declarers_position==a.positionData[c].dealer_position||(4==a.positionData[c].player_count||6==a.positionData[c].player_count)&&a.positionData[c].declarers_position==(a.positionData[c].dealer_position-1||a.positionData[c].player_count)?(a.positionStats[2].handsPicked++,a.positionData[c].won&&a.positionStats[2].handsWon++):a.positionData[c].declarers_position==d?(a.positionStats[0].handsPicked++,a.positionData[c].won&&a.positionStats[0].handsWon++):(a.positionStats[1].handsPicked++,a.positionData[c].won&&a.positionStats[1].handsWon++)}for(var e=0;e<a.positionStats.length;e++)a.positionStats[e].winRatio=Math.round(a.positionStats[e].handsWon/a.positionStats[e].handsPicked*1e3)/1e3,a.positionStats[e].record=""+a.positionStats[e].handsWon+" - "+(a.positionStats[e].handsPicked-a.positionStats[e].handsWon);a.positionStats.sort(function(a,b){return b.winRatio-a.winRatio})})},a.reloadScores(),a.winLossFilter=function(a){return a.hands_picked>=5},a.greaterThanZero=function(a){return a.sum>0}}]),app.controller("LeaguesController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.data=d.data,a.league={},a.showLeagueDetail=function(c){b.get("/api/leagues/"+c).then(function(b){a.league=b.data[0]})},a.eventDetail=function(a){d.data.eventDetail=a,c.path("/events")},a.clearLeague=function(){a.league={}}}]),app.controller("CreateLeagueController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.newLeagueName="",a.working=!1,a.itWorked=!1,a.postLeague=function(){a.working=!0,b.post("/api/leagues",{name:a.newLeagueName}).then(function(b){200===b.status?(console.log("League posted"),a.itWorked=!0,d.getLeagues(),c.path("/leagues")):console.log("ERROR")})}}]),app.controller("EventsController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.data=d.data,a.event={},a.eventDetail=d.data.eventDetail,a.working=function(){return!a.data.events||a.eventDetail&&!a.event.id?!0:void 0},a.showEventDetail=function(c){a.eventDetail=c,b.get("/api/events/"+c).then(function(b){a.event=b.data[0]})},d.data.eventDetail&&(a.showEventDetail(d.data.eventDetail),d.data.eventDetail=""),a.clearEvent=function(){a.event={},a.eventDetail="",d.data.eventDetail=""},a.handDetail=function(a){d.data.handDetail=a,c.path("/hands")}}]),app.controller("HandsController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.handDetailId=d.data.handDetail,a.hands=[],b.get("/api/hands/"+a.handDetailId).then(function(b){a.hands=b.data}),a.goBackToEvent=function(a){d.data.eventDetail=a,c.path("/events")}}]),app.controller("CreateEventController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.data=d.data,d.getUsersNoScores(),a.newEventName="",a.newEventDate=new Date,a.newEventLeagueID=1,a.newEventPlayerCount=3,a.newEventPlayers=[],a.range=function(a){return new Array(a)},a.postEvent=function(){if(""===a.newEventName||a.newEventPlayers.length<3)return!1;var e=a.newEventPlayers.map(Number);b.post("/api/events",{name:a.newEventName,date:a.newEventDate,league_id:a.newEventLeagueID,players:e}).then(function(a){a.data?(d.data.eventNeedingHands=a.data,c.path("/addHands")):console.log("ERROR")})}}]),app.controller("AddHandsController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){function e(a){for(var b=[],c=0;c<a.length;c++)if(0===c)b[0]=a[c].scores;else{b[c]=m(a[c].scores.length);for(var d=0;d<a[c].scores.length;d++)b[c][d]=a[c].scores[d]-a[c-1].scores[d]}return b}function f(a){for(var b,c,d=0;d<a.length;d++)(!b||a[d]>b)&&(b=a[d],c=d);return c}function g(a){for(var b,c,d=0;d<a.length;d++)(!b||a[d]<b)&&(b=a[d],c=d);return c}function h(a){for(var b=0,c=0;c<a.length;c++)a[c]>0&&b++;return b}function i(a){for(var b=0,c=0;c<a.length;c++)a[c]<0&&b++;return b}function j(a){var b=1;return a.bqb&&(b*=2),a.rqb&&(b*=2),a.bjb&&(b*=2),a.rjb&&(b*=2),a.crack&&(b*=2),a.bqbc&&(b*=2),a.rqbc&&(b*=2),a.bjbc&&(b*=2),a.rjbc&&(b*=2),a.recrack&&(b*=2),b}function k(a,b,c){var e={};e.eventId=d.data.eventNeedingHands;var k,l,m=a.slice(0),n=j(b),o=h(a),p=i(a);return b.leaster?(k=f(a),e.declarerID=c.players[k].id,e.won=!0,a[k]===3*p&&(e.schwarz=!0),e):b.moster?(k=g(a),e.declarerID=c.players[k].id,e.won=!1,e):(1===o?(k=f(a),e.declarerID=c.players[k].id,e.won=!0,a[k]/n===p?e.schneider=!0:a[k]/n===2*p?e.schneider=!1:a[k]/n===3*p&&(e.schwarz=!0)):1===p?(k=g(a),e.declarerID=c.players[k].id,e.won=!1,a[k]/n===-2*o?e.schneider=!0:a[k]/n===-4*o?e.schneider=!1:a[k]/n===-6*o&&(e.schwarz=!0)):p>o?(k=f(a),e.declarerID=c.players[k].id,e.won=!0,m[k]=0,l=f(m),e.partnerID=c.players[l].id,a[k]/n===p-1?e.schneider=!0:a[k]/n===2*(p-1)?e.schneider=!1:a[k]/n===3*(p-1)&&(e.schwarz=!0)):o>p&&(k=g(a),e.declarerID=c.players[k].id,e.won=!1,m[k]=0,l=g(m),e.partnerID=c.players[l].id,a[k]/n===-2*(o-1)?e.schneider=!0:a[k]/n===-4*(o-1)?e.schneider=!1:a[k]/n===-6*(o-1)&&(e.schwarz=!0)),e)}function l(a){if(a.length<1)return!1;for(var b=0;b<a.length;b++)if(a[b].warning===!0)return!1;return!0}a.event={},a.hands=[];var m=function(a){return new Array(a)};b.get("/api/events/"+d.data.eventNeedingHands).then(function(b){a.event=b.data[0],a.hands[0]={scores:m(a.event.players.length)}}),a.addRound=function(){a.hands[a.hands.length]={scores:m(a.event.players.length)}},a.deleteRow=function(b){a.hands.splice(b,1)},a.reviewHands=function(){for(var b=e(a.hands),c=0;c<a.hands.length;c++){a.hands[c].narrativizedHand=k(b[c],a.hands[c],a.event);for(var d=0,f=0;f<b[c].length;f++)d+=b[c][f];0!==d?a.hands[c].warning=!0:a.hands[c].leaster&&1!==h(b[c])?a.hands[c].warning=!0:a.hands[c].moster&&1!==i(b[c])?a.hands[c].warning=!0:a.hands[c].leaster||a.hands[c].moster||void 0!==a.hands[c].narrativizedHand.schneider||void 0!==a.hands[c].narrativizedHand.schwarz?a.hands[c].warning=!1:a.hands[c].warning=!0}a.postHands(),console.log(a.hands)},a.postHands=function(){return l(a.hands)?(d.data.handDetail=a.hands[0].narrativizedHand.eventId,console.log("All clear, post goes here."),void b.post("/api/hands",a.hands).then(function(a){d.getEvents(),d.getUsers(),c.path("/hands")})):(console.log("I can't go for that"),!1)}}]),app.controller("UsersController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.data=d.data,a.user={},a.showUserDetail=function(c){b.get("/api/users/"+c).then(function(b){a.user=b.data[0]})},a.eventDetail=function(a){d.data.eventDetail=a,c.path("/events")},a.clearUser=function(){a.user={}}}]),app.controller("CreateUserController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.newUserName="",a.userCreated=!1,a.postUser=function(){a.userCreated=!1,b.post("/api/users",{name:a.newUserName}).then(function(b){200===b.status?a.userCreated=!0:console.log("ERROR")})}}]),app.controller("LoginController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.username="",a.password="",a.loginFailed="Login Failed",a.showFailedMessage=!1,a.admin=d.admin,a.login=function(){a.showFailedMessage=!1,b.post("/login",{username:a.username,password:a.password}).then(function(b){b.data.username?(a.admin=b.data,d.admin=b.data):a.showFailedMessage=!0})},a.createLeague=function(){c.path("/createLeague")},a.createEvent=function(){c.path("/createEvent")},a.createUser=function(){c.path("/createUser")}}]),app.factory("SheepsheadService",["$http",function(a){var b={eventNeedingHands:0,admin:{}},c=function(){a.get("/api/leagues").then(function(a){b.leagues=a.data})},d=function(){a.get("/api/events").then(function(a){b.events=a.data})},e=function(){a.get("/api/users").then(function(a){b.users=a.data})},f=function(){a.get("/api/users/noScores").then(function(a){b.usersNoScores=a.data})};return{data:b,getLeagues:c,getEvents:d,getUsers:e,getUsersNoScores:f}}]);