var app=angular.module("sheepsheadApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).when("/leagues",{templateUrl:"views/leagues.html",controller:"LeaguesController"}).when("/createLeague",{templateUrl:"views/createLeague.html",controller:"CreateLeagueController"}).when("/events",{templateUrl:"views/events.html",controller:"EventsController"}).when("/createEvent",{templateUrl:"views/createEvent.html",controller:"CreateEventController"}).when("/addHands",{templateUrl:"views/addHands.html",controller:"AddHandsController"}).when("/users",{templateUrl:"views/users.html",controller:"UsersController"}).when("/createUser",{templateUrl:"views/createUser.html",controller:"CreateUserController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}),b.html5Mode(!0)}]),app.controller("HomeController",["$scope","$http","SheepsheadService",function(a,b,c){c.getLeagues(),c.getEvents(),c.getUsers()}]),app.controller("LeaguesController",["$scope","$http","SheepsheadService",function(a,b,c){c.getLeagues(),a.leagues=c.data.leagues,a.league={},a.showLeagueDetail=function(c){b.get("/api/leagues/"+c).then(function(b){a.league=b.data[0]})},a.clearLeague=function(){a.league={}}}]),app.controller("CreateLeagueController",["$scope","$http","$location",function(a,b,c){a.newLeagueName="",a.postLeague=function(){b.post("/api/leagues",{name:a.newLeagueName}).then(function(a){200===a.status?c.path("/leagues"):console.log("ERROR")})}}]),app.controller("EventsController",["$scope","$http","SheepsheadService",function(a,b,c){c.getEvents(),a.events=c.data.events,a.event={},a.showEventDetail=function(c){b.get("/api/events/"+c).then(function(b){a.event=b.data[0]})},a.clearEvent=function(){a.event={}}}]),app.controller("CreateEventController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.leagues=d.data.leagues,a.users=d.data.users,a.newEventName="",a.newEventDate=new Date,a.newEventLeagueID=1,a.newEventPlayerCount=3,a.newEventPlayers=[],a.range=function(a){return new Array(a)},a.postEvent=function(){var e=a.newEventPlayers.map(Number);b.post("/api/events",{name:a.newEventName,date:a.newEventDate,league_id:a.newEventLeagueID,players:e}).then(function(a){a.data?(d.data.eventNeedingHands=a.data,c.path("/addHands")):console.log("ERROR")})}}]),app.controller("AddHandsController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){function e(a){for(var b=[],c=0;c<a.length;c++)if(0===c)b[0]=a[c].scores;else{b[c]=l(a[c].scores.length);for(var d=0;d<a[c].scores.length;d++)b[c][d]=a[c].scores[d]-a[c-1].scores[d]}return b}function f(a){for(var b,c,d=0;d<a.length;d++)(!b||a[d]>b)&&(b=a[d],c=d);return c}function g(a){for(var b,c,d=0;d<a.length;d++)(!b||a[d]<b)&&(b=a[d],c=d);return c}function h(a){for(var b=0,c=0;c<a.length;c++)a[c]>0&&b++;return b}function i(a){for(var b=0,c=0;c<a.length;c++)a[c]<0&&b++;return b}function j(a){var b=1;return a.bqb&&(b*=2),a.rqb&&(b*=2),a.bjb&&(b*=2),a.rjb&&(b*=2),a.crack&&(b*=2),a.bqbc&&(b*=2),a.rqbc&&(b*=2),a.bjbc&&(b*=2),a.rjbc&&(b*=2),a.recrack&&(b*=2),b}function k(a,b,c){var e={};e.eventId=d.data.eventNeedingHands;var k,l,m=a.slice(0),n=j(b);if(b.leaster)return k=f(a),e.declarerID=c.players[k].id,e.won=!0,e;if(b.moster)return k=g(a),e.declarerID=c.players[k].id,e.won=!1,e;var o=h(a),p=i(a);return 1===o?(k=f(a),e.declarerID=c.players[k].id,e.won=!0,a[k]/n===p?e.schneider=!0:a[k]/n===2*p?e.schneider=!1:a[k]/n===3*p&&(e.schwarz=!0)):1===p?(k=g(a),e.declarerID=c.players[k].id,e.won=!1,a[k]/n===-2*o?e.schneider=!0:a[k]/n===-4*o?e.schneider=!1:a[k]/n===-6*o&&(e.schwarz=!0)):p>o?(k=f(a),e.declarerID=c.players[k].id,e.won=!0,m[k]=0,l=f(m),e.partnerID=c.players[l].id,a[k]/n===p-1?e.schneider=!0:a[k]/n===2*(p-1)?e.schneider=!1:a[k]/n===3*(p-1)&&(e.schwarz=!0)):o>p&&(k=g(a),e.declarerID=c.players[k].id,e.won=!1,m[k]=0,l=g(m),e.partnerID=c.players[l].id,a[k]/n===-2*(o-1)?e.schneider=!0:a[k]/n===-4*(o-1)?e.schneider=!1:a[k]/n===-6*(o-1)&&(e.schwarz=!0)),e}a.event={},a.hands=[];var l=function(a){return new Array(a)};b.get("/api/events/"+d.data.eventNeedingHands).then(function(b){a.event=b.data[0],a.hands[0]={scores:l(a.event.players.length)}}),a.addRound=function(){console.log(a.hands),a.hands[a.hands.length]={scores:l(a.event.players.length)}},a.reviewHands=function(){for(var b=e(a.hands),c=0;c<a.hands.length;c++){a.hands[c].narrativizedHand=k(b[c],a.hands[c],a.event);var d=a.hands[c].narrativizedHand;null===d.schneider&&null===d.schwarz&&d.leaster!==!0&&d.moster!==!0&&(a.hands[c].warning=!0)}console.log(a.hands)}}]),app.controller("UsersController",["$scope","$http","SheepsheadService",function(a,b,c){c.getUsers(),a.users=c.data.users,a.user={},a.showUserDetail=function(c){b.get("/api/users/"+c).then(function(b){a.user=b.data[0]})},a.clearUser=function(){a.user={}}}]),app.controller("CreateUserController",["$scope","$http","$location",function(a,b,c){a.newUserName="",a.postUser=function(){b.post("/api/users",{name:a.newUserName}).then(function(a){200===a.status?c.path("/users"):console.log("ERROR")})}}]),app.controller("LoginController",["$scope","$http","$location","SheepsheadService",function(a,b,c,d){a.username="",a.password="",a.loginFailed="Login Failed",a.showFailedMessage=!1,a.admin=d.admin,a.login=function(){a.showFailedMessage=!1,b.post("/login",{username:a.username,password:a.password}).then(function(b){b.data.username?(a.admin=b.data,d.admin=b.data):a.showFailedMessage=!0})},a.createLeague=function(){c.path("/createLeague")},a.createEvent=function(){c.path("/createEvent")},a.createUser=function(){c.path("/createUser")}}]),app.factory("SheepsheadService",["$http",function(a){var b={eventNeedingHands:0,admin:{}},c=function(){a.get("/api/leagues").then(function(a){b.leagues=a.data})},d=function(){a.get("/api/events").then(function(a){b.events=a.data})},e=function(){a.get("/api/users").then(function(a){b.users=a.data})};return{data:b,getLeagues:c,getEvents:d,getUsers:e}}]);